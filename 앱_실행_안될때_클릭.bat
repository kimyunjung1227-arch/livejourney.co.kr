@echo off
title LiveJourney ì•± ì‹¤í–‰ ì§„ë‹¨ ë„êµ¬
echo ======================================================
echo ðŸ” [1ë‹¨ê³„] ì‹œìŠ¤í…œ í™˜ê²½ ì ê²€ ì¤‘...
echo ======================================================

setlocal
cd /d "%~dp0"

:: Node.js í™•ì¸
where node >nul 2>nul
if %errorlevel% neq 0 (
    echo âŒ [ì˜¤ë¥˜] Node.jsê°€ ì„¤ì¹˜ë˜ì–´ ìžˆì§€ ì•Šê±°ë‚˜ PATHì— ì—†ìŠµë‹ˆë‹¤.
    echo    https://nodejs.org/ ì—ì„œ Node.jsë¥¼ ì„¤ì¹˜í•´ ì£¼ì„¸ìš”.
    goto error
)
echo âœ… Node.js í™•ì¸ ì™„ë£Œ

:: npm í™•ì¸
where npm >nul 2>nul
if %errorlevel% neq 0 (
    echo âŒ [ì˜¤ë¥˜] npm ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    goto error
)
echo âœ… npm í™•ì¸ ì™„ë£Œ

:: mobile í´ë” í™•ì¸
if not exist "mobile" (
    echo âŒ [ì˜¤ë¥˜] 'mobile' í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. 
    echo    íŒŒì¼ì´ í˜„ìž¬ í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë”ì— ìžˆëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.
    goto error
)
cd mobile
echo âœ… mobile í´ë” ì´ë™ ì™„ë£Œ

:: í¬íŠ¸ ì ìœ  í™•ì¸ (ê¸°ì¡´ ì—‘ìŠ¤í¬ ì„œë²„ ì¢…ë£Œ ìœ ë„)
echo ðŸ” [2ë‹¨ê³„] ê¸°ì¡´ ì‹¤í–‰ ì¤‘ì¸ ì„œë²„ í™•ì¸ ì¤‘...
for /f "tokens=5" %%a in ('netstat -aon ^| findstr :8081') do (
    if not "%%a"=="0" (
        echo âš ï¸  8081 í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ìž…ë‹ˆë‹¤. ê¸°ì¡´ ì„œë²„ë¥¼ ì¢…ë£Œí• ê¹Œìš”? (Y/N)
        set /p user_choice=ìž…ë ¥: 
        if /i "%user_choice%"=="Y" (
            taskkill /F /PID %%a
            echo âœ… ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ì™„ë£Œ.
        )
    )
)

echo.
echo ======================================================
echo ðŸš€ [3ë‹¨ê³„] ì—‘ìŠ¤í¬ ì‹¤í–‰ ì‹œìž‘ (Tunnel ëª¨ë“œ)
echo ======================================================
echo.
echo ðŸ’¡ Expo Go ì•±ìœ¼ë¡œ QR ì½”ë“œë¥¼ ìŠ¤ìº”í•´ ì£¼ì„¸ìš”.
echo.

call npm run tunnel

if %errorlevel% neq 0 (
    echo.
    echo âŒ [ì˜¤ë¥˜] ì—‘ìŠ¤í¬ ì‹¤í–‰ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
    goto error
)

:error
echo.
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo í”„ë¡œê·¸ëž¨ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.
echo ì°½ì„ ë‹«ìœ¼ë ¤ë©´ ì•„ë¬´ í‚¤ë‚˜ ëˆ„ë¥´ì„¸ìš”.
pause >nul
